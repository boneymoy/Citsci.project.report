\chapter{Ergebnisse}\label{ch:erg}

In diesem Kapitel sollen die Ergebnisse der Experimente dargestellt und ausgewertet werden.
\autoref{sec:erg_LSTM} untersucht Konfigurationen des \ac{LSTM} ohne Verwendung von Extraparametern.
Dabei werden diese speziell nur entweder nach \ac{DR} oder Anzahl der \acp{FP} eingestuft.
In \autoref{sec:erg_LSTM_extra} werden auch Ergebnisse mit Extraparametern hinzugezogen.
Dabei soll zusätzlich eine beste Konfiguration gefunden werden welche nicht entweder die \ac{DR} oder die \acp{FP} isoliert betrachtet.
Zusätzlich werden in \autoref{sec:erg_vgl} Ergebnisse weiterer Arbeiten mit dieser Arbeit verglichen.
Dabei gibt es wie in \autoref{ch:verwandte_arbeiten} beschrieben nur eine Arbeit die ebenfalls ein \ac{LSTM} auf demselben Datensatz verwenden.

\section{Berechnungsdauer}\label{sec:erg_time}
    Wie bereits in mehreren Kapiteln erwähnt besteht eine große Schwierigkeit beim Einsatz dieses auf \ac{LSTM} basierenden Algorithmus in der \ac{HIDS} in der Berechnungszeit.
    Für die Berechnungen wurden zwei verschiedene Grafikkarten auf dem Galaxy Cluster der Universität Leipzig genutzt.
    Das EPS CWE-$434$ sowie das ZipSlip Szenario wurden auf einer NVIDIA Tesla V100 Graphikkarte berechnet und für die restlichen kleineren Szenarien wurde eine NVIDIA RTX 2080 Ti verwendet.
    Die Trainingszeit spielt dabei eine untergeordnete Rolle, da diese für den Live-Betrieb keine Rolle spielt.
    Im Folgenden werden die durchschnittlichen Berechnungszeiten für die verschiedenen Szenarien gelistet.
    \begin{table}[ht]
        \centering
        \begin{tabular}{lr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{2}{c}{Berechnungszeiten der verschiedenen Szenarien}\\
            \toprule
            Szenario &  $\overline{Detection Time}$ in min\\
            \midrule
            \rowcolor{GruvGray!16}
            CVE-2017-7529 & $16.22$ \\
            CVE-2014-0160 & $34.48$ \\
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & $53.69$ \\
            CVE-2012-2122 & $55.87$ \\
            \rowcolor{GruvGray!16}
            CVE-2019-5418 & $155.69$ \\
            CVE-2018-3760 & $171.56$ \\
            \rowcolor{GruvGray!16}
            PHP CWE-434 & $193.55$ \\
            SQL Injection CWE-89 & $212.00$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 & $1157.83$ \\	
            ZipSlip & $2253.75$ \\	
            \hline
        \end{tabular}
        \caption{Durchschnittliche Berechnungszeiten zur Bestimmung der Anomaliescores aller Testdaten der einzelnen Szenarien.}
        \label{tab:LSTM_erg_time}
    \end{table}
    Wie zu erkennen benötigen die beiden großen Szenarien trotz der besseren Grafikkarte wesentlich länger.
    Um die in \autoref{tab:LSTM_erg_time} beschriebenen Ergebnisse zu erzielen wurden bereits einige Abstriche gemacht.
    So wurde kein Vergleich des \ac{OHE} mit dem \ac{W2V} gezogen, aufgrund der Größe des \ac{OHE}.
    Auch wurden die möglichen Parameter, sowie Parametergrößen stark eingeschränkt um die Anzahl der zu Berechnenden Konfigurationen klein zu halten.
    Für die Auswahl wurden Tests auf kleineren Szenarien durchgeführt.
    
    Bei besonders großen Eingaben, also n-grammen größer $2$ oder Embedding Größen größer als $8$ bei einer n-gram Größe von $2$ reicht auch der Speicher der NVIDIA Tesla V100 Grafikkarte für das ZipSlip Szenario nicht mehr aus.
    Das mindert leider die Vergleichbarkeit.
    Konfigurationen welche kein Ergebnis für das ZIPSlip Szenario lieferten sind mit Sternchen markiert.

\section{LSTM Ansatz}\label{sec:erg_LSTM}
    Im ersten Schritt der Auswertung wird die \ac{DR} isoliert für Konfigurationen betrachtet welche keine weiteren Extraparameter der System Calls enthalten.
    Alle Konfigurationen verwenden dabei \textit{Thread Aware} n-gramme.
    In \autoref{tab:LSTM_erg} werden die zehn besten Ergebnisse dargestellt.
    Die Durchschnittliche \ac{DR} von $0.69$ des besten Ergebnisses zeigt, dass es generell möglich ist mit \acp{LSTM} eine Anomalieerkennung auf Basis von System Calls umzusetzen.
    Eine klarer Zusammenhang zwischen Embedding Größe (embed) oder n-gram Größe (n-gram) und der \ac{DR} ist dabei nicht direkt zu erkennen.
    So hat die Konfiguration in Zeile $2$ mit einer n-gram Größe von $10$ und einer Embedding Größe von $4$ das \ac{LSTM} $10 \cdot 4=40$ Eingangsneuronen.
    Hingegen hat die Konfiguration aus Zeile $4$ nur $2 \cdot 4 = 8$ Eingangsneuronen.
    Beide Konfigurationen erzielen dabei sehr ähnliche Ergebnisse mit einer durchschnittlichen \ac{DR} von $0.67$ und $15.63$ \acp{FP} beziehungsweise $0.64$ und $13.50$.


    \begin{table}[ht]
        \centering
        \begin{tabular}{rrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{6}{c}{Ergebnisse für \ac{LSTM} ohne Extraparameter, nach \ac{DR}}\\
            \toprule
            n-gram & embed & \overline{\ac{FP}} & \ac{FP}\_sum & \overline{\ac{DR}} & count\\
            \midrule
            \rowcolor{GruvGray!16}
            $10$ & 	$4$ & 	$14.56$ &  	$131$ & 	$0.71$ &  	$9$ \\
            $6$ & 	$6$ & 	$22.22$ &  	$209$ & 	$0.69$ &  	$9$ \\
            \rowcolor{GruvGray!16}
            $2$ & 	$10$ & 	$9.22$  &  	$83$ & 	    $0.68$ &  	$9$ \\
            $2$ & 	$4$ & 	$12.89$ &  	$116$ & 	$0.68$ &  	$9$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$8$ & 	$17.78$ &  	$160$ & 	$0.67$ &  	$9$ \\
            $2$ & 	$6$ & 	$20.60$ &  	$206$ & 	$0.64$ &  	$10$ \\
            \rowcolor{GruvGray!16}
            $6$ & 	$4$ & 	$11.34$ &  	$102$ & 	$0.58$ &  	$9$ \\
            $10$ & 	$10$ & 	$5.78$ &  	$52$ & 	    $0.56$ &  	$9$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$6$ & 	$6.44$ &  	$58$ & 	    $0.56$ &  	$9$ \\
            $6$ & 	$10$ & 	$7.33$ &  	$66$ & 	    $0.56$ &  	$9$ \\
            \hline
        \end{tabular}
        \caption{Konfigurationen mit den $10$ höchsten \acp{DR}. 
                 Dabei wurden nur Konfigurationen betrachtet die keine Extraparameter nutzen.
                 Alle n-gramme sind \textit{Thread Aware}.}
        \label{tab:LSTM_erg}
    \end{table}

    Im zweiten Schritt der Auswertung sollen die besten Ergebnisse nur im Bezug auf die Anzahl der Fehlalarme, also \acp{FP} untersucht werden.
    In \autoref{tab:LSTM_erg_FP} werden wieder \textit{Thread Aware} n-gramme genutzt und nur Ergebnisse mit $\ac{DR}>0.5$ einbezogen.

    \begin{table}[ht]
        \centering
        \begin{tabular}{rrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{6}{c}{Ergebnisse für \ac{LSTM} ohne Extraparameter, nach \ac{FP}}\\
            \toprule
            n-gram & embed & \overline{\ac{FP}} & \ac{FP}\_sum & \overline{\ac{DR}} & count\\
            \midrule
            \rowcolor{GruvGray!16}
            $10$ & 	$10$ & 	$5.78$ &  	$52$ & 	    $0.56$ &  	$9$ \\
            $10$ & 	$6$ & 	$6.44$ &  	$58$ & 	    $0.56$ &  	$9$ \\
            \rowcolor{GruvGray!16}
            $6$ & 	$10$ & 	$7.33$ &  	$66$ & 	    $0.56$ &  	$9$ \\
            $2$ & 	$8$ & 	$8.40$ &  	$84$ & 	    $0.50$ &  	$10$ \\
            \rowcolor{GruvGray!16}
            $2$ & 	$10$ & 	$9.22$ &  	$83$ & 	    $0.68$ &  	$9$ \\
            $6$ & 	$4$ & 	$11.34$ &  	$102$ & 	$0.58$ &  	$9$ \\
            \rowcolor{GruvGray!16}
            $2$ & 	$4$ & 	$12.89$ &  	$116$ & 	$0.68$ &  	$9$ \\
            $10$ & 	$4$ & 	$14.56$ &  	$131$ & 	$0.71$ &  	$9$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$8$ & 	$17.78$ &  	$160$ & 	$0.67$ &  	$9$ \\
            $2$ & 	$6$ & 	$20.60$ &  	$206$ & 	$0.64$ &  	$10$ \\
            \hline
        \end{tabular}
        \caption{Konfigurationen mit den $10$ niedrigsten \acp{FP}. 
                 Dabei wurden nur Konfigurationen betrachtet die keine Extraparameter nutzen.
                 Alle n-gramme sind \textit{Thread Aware}.
                 Es wurden nur Konfigurationen mit $\ac{DR}>0.5$ einbezogen.}
        \label{tab:LSTM_erg_FP}
    \end{table}
    
    Hierbei ergibt sich ein ähnliches Bild wie zuvor, da es nur wenig mehr als zehn Konfigurationen ohne Extraparameter mit einer $\ac{DR}>0.5$ gibt.
    Doch die Tabelle kann genutzt werden um noch einmal auf die Schwierigkeit der Auswahl der besten Konfigurationen hinzuweisen.
    Ist eine Konfiguration mit hoher \ac{DR} oder eine Konfiguration mit wenigen \acp{FP} zu bevorzugen?
    Oder konkret wie in diesem Fall, ist eine $\ac{DR}=0.69$ bei $22$ Fehlern in grob acht Stunden Testaufnahmen der Konfiguration mit einer $\ac{DR}=0.51$ bei ca. $5$ Fehlern zu bevorzugen?
    Der Versuch eine beste Konfiguration auszuwählen soll nach Betrachtung der Konfigurationen mit Extraparametern unternommen werden.

\section{Extra Parameter}\label{sec:erg_LSTM_extra}
    In \autoref{tab:LSTM_par_erg} werden die Ergebnisse der Konfigurationen mit Extraparametern angezeigt. 
    Wieder werden die Ergebnisse zunächst nach der besten \ac{DR} eingestuft.
    Als erstes fällt dabei ins Auge, dass die besten sechs der zehn Konfigurationen Extraparameter verwenden.
    % Dies gibt einen Hinweis darauf, dass die Parameter im Einsatz in Kombination mit einem \ac{LSTM} sehr nützlich sind.
    Im Vergleich der besten Konfigurationen, werden ohne Extraparameter wie beschrieben eine \ac{DR} von $0.71$ bei durchschnittlich $14.56$ Fehlern erreicht.
    Mit Extraparametern beträgt die \ac{DR} $0.88$ bei durchschnittlich $22.89$ Fehlern.
    Also eine sehr deutliche Verbesserung.
    Auffällig dabei ist, dass wie in \autoref{tab:LSTM_erg} keinerlei Zusammenhang zwischen Eingangsneuronen und Ergebnisqualität zu erkennen ist.
    Im Vergleich wird die Spanne sogar noch größer.
    Die Konfiguration in Zeile drei benötigt $10\cdot8 + 1 + 1=82$ Eingangsneuronen und in die Konfiguration in der neunten Zeile  lediglich $2\cdot4 + 1 = 9$.
    In den sechs besten Ergebnissen nach der \ac{DR} wird die \ac{TCF} eingesetzt.
    Nur zwei der besten zehn Ergebnisse verwenden keine Rückgabewerte.
    \begin{table}[ht]
        \centering
        \begin{tabular}{rrrrrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{9}{c}{Ergebnisse für \ac{LSTM} mit Extraparameter}\\
            \toprule
            n-gram & embed & \textit{rv} & \ac{TCF} & \textit{time} & \overline{\ac{FP}} & \ac{FP}\_sum & \overline{\ac{DR}} & count\\
            \midrule
            \rowcolor{GruvGray!16}
            $6$ & 	$8$ & 	$1$ & 	$1$ & 	$1$ & 	$22.89$ &  	$206$ & 	$0.88$ &  	$9$ \\
            $10$ & 	$4$ & 	$1$ & 	$1$ & 	$0$ & 	$14.00$ &  	$140$ & 	$0.76$ &  	$10$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$8$ & 	$0$ & 	$1$ & 	$1$ & 	$18.56$ &  	$167$ & 	$0.76$ &  	$9$ \\
            $10$ & 	$4$ & 	$0$ & 	$1$ & 	$0$ & 	$5$ &   	$45$ & 	    $0.74$ &  	$9$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$4$ & 	$1$ & 	$0$ & 	$0$ & 	$13.78$ &  	$124$ & 	$0.74$ &  	$9$ \\
            $10$ & 	$4$ & 	$1$ & 	$1$ & 	$1$ & 	$22.33$ &  	$201$ & 	$0.74$ &  	$9$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$4$ & 	$0$ & 	$0$ & 	$0$ & 	$14.56$ &  	$131$ & 	$0.71$ &  	$9$ \\
            $6$ & 	$8$ & 	$1$ & 	$1$ & 	$0$ & 	$9.00$ &   	$81$ & 	    $0.70$ &  	$9$ \\
            \rowcolor{GruvGray!16}
            $2$ & 	$8$ & 	$1$ & 	$1$ & 	$1$ & 	$14.00$ &  	$140$ & 	$0.70$ &  	$10$ \\
            $6$ & 	$4$ & 	$1$ & 	$0$ & 	$1$ & 	$18.22$ &  	$164$ & 	$0.70$ &  	$9$ \\
            \hline
        \end{tabular}
        \caption{Konfigurationen mit den $10$ höchsten \acp{DR}. 
                 Es wurden Konfigurationen mit und ohne Extraparameter betrachtet.
                 Alle n-gramme sind \textit{Thread Aware}.
                 Bei allen Konfigurationen kommen die Extraparameter zum Einsatz.}
        \label{tab:LSTM_par_erg}
    \end{table}

    Doch mit Betrachtung der Ergebnisse nach den wenigsten \acp{FP} in \autoref{tab:LSTM_FP} ist dieses Bild nicht mehr so klar.
    Zwar wird die \ac{DR} des besten Ergebnisses bei ähnlich vielen Fehlalarmen um $0.2$ gesteigert, so ist die Dominanz der Konfigurationen nicht mehr ganz so deutlich.
    Zwei der besten zehn Ergebnisse enthalten mehr als einen Parameter, im Vergleich zu sieben in \autoref{tab:LSTM_par_erg}.
    Aber auch nur eins der besten acht Ergebnisse enthält keinen Parameter.

    \begin{table}[ht]
        \centering
        \begin{tabular}{rrrrrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{9}{c}{Ergebnisse für \ac{LSTM} mit Extraparameter}\\
            \toprule
            n-gram & embed & \textit{rv} & \ac{TCF} & \textit{time} & \overline{\ac{FP}} & \ac{FP}\_sum & \overline{\ac{DR}} & count\\
            \midrule
            \rowcolor{GruvGray!16}
            $6$ & 	$8$ & 	$0$ & 	$0$ & 	$1$ & 	$4.66$ & 	$42$ & 	$0.67$ & 	$9$ \\
            $10$ & 	$4$ & 	$0$ & 	$1$ & 	$0$ & 	$5$    & 	$45$ & 	$0.74$ & 	$9$ \\
            \rowcolor{GruvGray!16}
            $6$ & 	$4$ & 	$0$ & 	$0$ & 	$1$ & 	$5.38$ & 	$43$ & 	$0.64$ & 	$8$ \\
            $2$ & 	$4$ & 	$1$ & 	$1$ & 	$0$ & 	$5.38$ & 	$43$ & 	$0.51$ & 	$8$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$6$ & 	$0$ & 	$1$ & 	$0$ & 	$5.66$ & 	$51$ & 	$0.60$ & 	$9$ \\
            $10$ & 	$10$ & 	$0$ & 	$0$ & 	$0$ & 	$5.78$ & 	$52$ & 	$0.56$ & 	$9$ \\
            \rowcolor{GruvGray!16}
            $6$ & 	$6$ & 	$1$ & 	$1$ & 	$1$ & 	$6.33$ & 	$57$ & 	$0.66$ & 	$9$ \\
            $10$ & 	$6$ & 	$1$ & 	$0$ & 	$0$ & 	$6.33$ & 	$57$ & 	$0.55$ & 	$9$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$6$ & 	$0$ & 	$0$ & 	$0$ & 	$6.44$ & 	$58$ & 	$0.56$ & 	$9$ \\
            $6$ & 	$10$ & 	$0$ & 	$0$ & 	$0$ & 	$7.33$ & 	$66$ & 	$0.56$ & 	$9$ \\
            \hline
        \end{tabular}
        \caption{Konfigurationen mit den $10$ niedrigsten \ac{FP}-Raten. 
                 Es wurden Konfigurationen mit und ohne Extraparameter betrachtet.  Alle n-gramme sind \textit{Thread Aware}.
                 Auch hier kommen bei den meisten Konfigurationen die Extraparameter zum Einsatz.}
        \label{tab:LSTM_FP}
    \end{table}

    In \autoref{tab:LSTM_vs} werden die zwei Gewinnerkonfigurationen aus \autoref{tab:LSTM_par_erg} und \autoref{tab:LSTM_FP} gegenübergestellt.
    Dabei werden die Ergebnisse jedes Szenarios angegeben. 
    %TODO
    {\color{red} Ergebnisse abwarten}

    \begin{table}[ht]
        \centering
        \begin{tabular}{lrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{6}{c}{Vergleich Konfiguration mit höchster \ac{DR} vs niedrigste \ac{FP}-Rate}\\
            \hline
            Szenario & \ac{FP} & \ac{DR} & vs & \acp{FP} & \ac{DR}\\
            \toprule
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307   & $29$ & $0.939$ & x & $12$ & $0.643$ \\
            CVE-2012-2122 	      & $18$ & $0.987$ & x & $14$ & $0.052$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 	      & $13$ & $0.030$ & x & $4$  & $0.010$ \\
            CVE-2017-7529 	      & $0$  & $0.989$ & x & $1$  & $0.989$ \\
            \rowcolor{GruvGray!16} 
            CVE-2018-3760 	      & $4$  & $1$ & x & $1$  & $1$ \\
            CVE-2019-5418 	      & $7$  & $1$ & x & $1$  & $0.951$ \\
            \rowcolor{GruvGray!16}
            PHP CWE-434 	      & $24$ & $1$ & x & $3$  & $1$\\
            SQL Injection CWE-89 &	$82$ & $1$ & x & $5$  & $1$\\
            \rowcolor{GruvGray!16}
            EPS CWE-434 	      & $29$ & $1$ & x & $4$  & $1$ \\
            ZIP Slip              & xxx  & xxx        & x & xxx  & xxx \\
            \hline
        \end{tabular}
        \caption{Vergleich bester Ergebnisse.
                Höchste \ac{DR} links mit folgenden Parametern: $n=6, e=8, rv=1, \ac{TCF}=1, time=1$.
                Niedrigste \ac{FP}-Rate rechts mit folgenden Parametern: $n=10, e=4, rv=0, \ac{TCF}=1, time=0$}
        \label{tab:LSTM_vs}
    \end{table}

    \begin{table}[ht]
        \centering
        \begin{tabular}{lrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{6}{c}{Vergleich Konfiguration mit höchster \ac{DR} vs niedrigste \ac{FP}-Rate}\\
            \hline
            Szenario & \ac{FP} & \ac{DR} & vs & \acp{FP} & \ac{DR}\\
            \toprule
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307   & $29$ & $0.939$ & x & $10$ & $0.071$ \\
            CVE-2012-2122 	      & $18$ & $0.987$ & x & $10$ & $0.019$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 	      & $13$ & $0.030$ & x & $5$  & $0$ \\
            CVE-2017-7529 	      & $0$  & $0.989$ & x & $3$  & $0.989$ \\
            \rowcolor{GruvGray!16} 
            CVE-2018-3760 	      & $4$  & $1$ & x & $0$  & $1$ \\
            CVE-2019-5418 	      & $7$  & $1$ & x & $3$  & $0.990$ \\
            \rowcolor{GruvGray!16}
            PHP CWE-434 	      & $24$ & $1$ & x & $1$  & $1$\\
            SQL Injection CWE-89 &	$82$ & $1$ & x & $1$  & $1$\\
            \rowcolor{GruvGray!16}
            EPS CWE-434 	      & $29$ & $1$ & x & $9$  & $1$ \\
            ZIP Slip              & xxx  & xxx        & x & xxx  & xxx \\
            \hline
        \end{tabular}
        \caption{Vergleich bester Ergebnisse.
                Höchste \ac{DR} links mit folgenden Parametern: $n=6, e=8, rv=1, \ac{TCF}=1, time=1$.
                Niedrigste \ac{FP}-Rate rechts mit folgenden Parametern: $n=6, e=8, rv=0, \ac{TCF}=0, time=1$}
        \label{tab:LSTM_vs_alternative}
    \end{table}

\section{Vergleich anderer Arbeiten}\label{sec:erg_vgl}
    Um die Ergebnisse einordnen zu können soll im Folgenden ein Vergleich zu anderen Arbeiten die den \ac{LID-DS} verwenden gezogen werden.
    Dafür steht der \ac{STIDE} von Grimmer et al.~\cite{IDSTHREADGRIMMER2021} zur Verfügung.
    Der Vergleich der beiden besten \ac{LSTM} Konfigurationen und dem \ac{STIDE} Algorithmus wird in \autoref{tab:LSTM_stide_erg} dargestellt.
    Dabei wird im \ac{STIDE} ein \ac{SW} verwendet.
    Ein \ac{SW} wird ähnlich zu einem n-gram aufgenommen.
    Dafür werden aber nur die Anomaliescores der einzelnen n-gramme genommen und gemittelt.
    Ein Alarm beinhaltet dann wie in diesem speziellen Fall $1000$ n-gramme. 
    
    \begin{table}[ht]
        \centering
        \begin{tabular}{lrrrrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{9}{c}{Ergebnisse für \ac{LSTM} mit Extraparameter}\\
            \toprule
            Algorithmus & n-gram & embed & \ac{SW} & \textit{rv} & \ac{TCF} & \textit{time} & \overline{\ac{FP}} & \overline{\ac{DR}} \\
            \midrule
            \ac{STIDE} & $5$ & int & $1000$ & $0$ & $0$ & $0$ & $61.5$ & $0.986$ \\
            \rowcolor{GruvGray!16}
            best \ac{DR} LSTM & $6$ & 	$8$ & $1$ & 	$1$ & 	$1$ & 	$1$ & 	$22.89$& 	$0.88$ \\
            \rowcolor{GruvGray!16}
            best \ac{FP} LSTM & $10$ & 	$4$ & $1$ &	$0$ & 	$1$ & 	$0$ & 	$5.03$ & 	$0.71$ \\
            \hline
        \end{tabular}
        \caption{}
        \label{tab:LSTM_stide_erg}
    \end{table}

    Um eine weitere Einschätzung zu bekommen welche Konfigurationen am besten funktionieren werden in~\cite{IDSTHREADGRIMMER2021} fünf Anforderungslevel für Fehlalarme erstellt.
    Diese lauten: Level $1$ \acp{FP}<40, Level $2$ \acp{FP}<20, Level $3$ \acp{FP}<10, Level $4$ \acp{FP}<5, Level $5$ \acp{FP}<2.5.
    In \autoref{tab:LSTM_lvl} wird für jedes Level die beste Konfiguration dieser Arbeit, links, mit der Arbeit von~\cite{IDSTHREADGRIMMER2021}, rechts, verglichen.
    Dabei werden auch die noch andere Algorithmen wie \ac{BOSC}, \ac{AE} und \ac{MLP} untersucht.


    \begin{table}[ht]
        \centering
        \begin{tabular}{llcccccccc}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{10}{c}{Ergebnisse für \ac{LSTM} mit Extraparameter}\\
            \toprule
            lvl & Algorithmus & n-gram & embed & \ac{SW} & \textit{rv} & \ac{TCF} & \textit{time} & \overline{\ac{FP}} & \overline{\ac{DR}} \\
            \midrule
            1 & \ac{STIDE} & $5$ & int & $100$  & $0$ & $0$ & $0$ & $23.7$ & $0.983$ \\
            2 & \ac{BOSC}  & $3$ & int & $10$ & $0$ & $0$ & $0$ & $18.9$ & $0.982$ \\
            3 & \ac{MLP}   & $7$ & \ac{OHE} & $1$ & $0$ & $0$ & $0$ & $4.2$ & $0.788$ \\
            4 & \ac{MLP}   & $7$ & \ac{OHE} & $1$ & $0$ & $0$ & $0$ & $4.2$ & $0.788$ \\
            5 & \ac{AE}    & $7$ & \ac{W2V} & $1$ & $0$ & $0$ & $0$ & $2.2$ & $0.622$ \\
            \rowcolor{GruvGray!16}
            1 & \ac{LSTM} &  $6$ & 	$8$ & $1$ &	$1$ & 	$1$ & 	$1$ & 	$22.89$& 	$0.88$ \\
            \rowcolor{GruvGray!16}
            2 & \ac{LSTM} &  $10$ & $4$ & $1$ &	$1$ &	$1$ & 	$0$ & 	$14$& 	$0.76$ \\
            \rowcolor{GruvGray!16}
            3 & \ac{LSTM} &  $10$ & $4$ & $1$ &	$0$ &	$1$ & 	$0$ & 	$5$& 	$0.74$ \\
            \rowcolor{GruvGray!16}
            4 & \ac{LSTM} &  $6$ & $8$ & $1$ &	$0$ &	$0$ & 	$1$ & 	$4.66$& 	$0.67$ \\
            \rowcolor{GruvGray!16}
            5 & x &  x & x & x &	x &	x & 	x & 	x   & 	x \\
            \hline
        \end{tabular}
        \caption{}
        \label{tab:LSTM_lvl}
    \end{table}

%TODO Betrachtung 2014 Szenario??



\iffalse
    Durchschnittliche Veränderung bei Hinzunahme time delta
    Durchschnittliche Veränderung bei Hinzunahme \ac{TCF}
    \begin{table}[ht]
        \centering
        \begin{tabular}{c|c|c|c}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{4}{c}{Vergleich Nutzung von \textit{time}}\\
            \hline
            Szenario & \textit{time} & $\overline{FP}$ & \overline{\ac{DR}}\\
            \hline
            \hline
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 &  	$1$ & 	$29.28$ &  	$0.324546$ \\
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$0$ & 	$21.78$ & 	$0.251867$ \\
            CVE-2012-2122 & 	        $1$ & 	$10.19$ & 	$0.039606$ \\
            CVE-2012-2122 &      	$0$ & 	$12.29$ & 	$0.018725$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	        $1$ & 	$6.48$ &  	$0.011111$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	        $0$ & 	$4.71$ &  	$0.005854$ \\
            CVE-2017-7529 &       	$1$ & 	$1.50$ &  	$0.906290$ \\
            CVE-2017-7529 & 	        $0$ & 	$0.83$ &  	$0.868517$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 & 	        $1$ & 	$10.14$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 &       	$0$ & 	$10.04$ & 	$1.000000$ \\
            CVE-2019-5418 &       	$1$ & 	$7.89$ &  	$0.584184$ \\
            CVE-2019-5418 &       	$0$ & 	$7.75$ &  	$0.575255$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 &        	$0$ & 	$14.92$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 & 	        $1$ & 	$20.96$ & 	$0.965517$ \\
            PHP CWE-434 &         	$0$ & 	$10.81$ & 	$0.935591$ \\
            PHP CWE-434 & 	        $1$ & 	$14.91$ & 	$0.887810$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$1$ & 	$21.39$ & 	$0.990278$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$0$ & 	$24.90$ & 	$0.974000$ \\
            ZipSlip & 	            $1$ & 	$8.26$ &  	$0.187500$ \\
            ZipSlip & 	            $0$ & 	$21.01$ & 	$0.176020$ \\
        \end{tabular}
        \caption{}
        \label{tab:LSTM_time_erg}
    \end{table}


    \begin{table}[ht]
        \centering
        \begin{tabular}{c|c|c|c}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{4}{c}{Vergleich Nutzung von \textit{rv}}\\
            \hline
            Szenario & \textit{rv} & $\overline{FP}$ & \overline{\ac{DR}}\\
            \hline
            \hline
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$1$ & 	$24.13$ & 	$0.311094$ \\
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$0$ & 	$23.32$ & 	$0 	0.259936$ \\
            CVE-2012-2122 & 	$1$ & 	$13.24$ & 	$0.039728$ \\
            CVE-2012-2122 & 	$0$ & 	$8.51$ & 	$0.017535$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	$1$ & 	$7.34$ & 	$0.011842$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	$0$ & 	$3.49$ & 	$0.004872$ \\
            CVE-2017-7529 & 	$1$ & 	$0.92$ & 	$0.910617$ \\
            CVE-2017-7529 & 	$0$ & 	$1.36$ & 	$0.862364$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 & 	$1$ & 	$9.18$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 & 	$0$ & 	$9.92$ & 	$1.000000$ \\
            CVE-2019-5418 & 	$1$ & 	$7.47$ & 	$0.684211$ \\
            CVE-2019-5418 & 	$0$ & 	$7.89$ & 	$0.474758$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 & 	    $0$ & 	$18.46$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 & 	    $1$ & 	$17.56$ & 	$0.962963$ \\
            PHP CWE-434 & 	    $0$ & 	$11.87$ & 	$0.919343$ \\
            PHP CWE-434 &   	$1$ & 	$12.13$ & 	$0.907001$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$1$ & 	$22.95$ & 	$0.984211$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$0$ & 	$22.11$ & 	$0 	0.979211$ \\
            ZipSlip & 	$0$ & 	$18.25$ & 	$0.196429$ \\
            ZipSlip & 	$1$ & 	$10.50$ & 	$0.167092$ \\
        \end{tabular}
        \caption{}
        \label{tab:LSTM_rv_erg}
    \end{table}


    \begin{table}[ht]
        \centering
        \begin{tabular}{c|c|c|c}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{4}{c}{Vergleich Nutzung von \ac{TCF}}\\
            \hline
            Szenario & \ac{TCF} & $\overline{FP}$ & \overline{\ac{DR}}\\
            \hline
            \hline
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$1$ & 	$29.67$ & 	$0.402494$ \\
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$0$ & 	$21.44$ & 	$0.183425$ \\
            CVE-2012-2122 & 	        $1$ & 	$4.91$ &  	$0.042652$ \\
            CVE-2012-2122 & 	        $0$ & 	$16.92$ & 	$0.016050$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	        $1$ & 	$4.67$ &  	$0.008333$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	        $0$ & 	$6.29$ &  	$0.008293$ \\
            CVE-2017-7529 & 	        $1$ & 	$1.50$ &  	$0.933589$ \\
            CVE-2017-7529 &      	$0$ & 	$0.83$ &  	$0.844547$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 &       	$1$ & 	$8.22$ &  	$1.000000$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 &       	$0$ & 	$11.73$ & 	$1.000000$ \\
            CVE-2019-5418 &       	$0$ & 	$9.73$ &  	$0.707317$ \\
            CVE-2019-5418 &       	$1$ & 	$5.57$ &  	$0.429738$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 & 	        $0$ & 	$17.54$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 &         	$1$ & 	$18.79$ & 	$0.965517$ \\
            PHP CWE-434 &         	$1$ & 	$13.72$ & 	$0.935545$ \\
            PHP CWE-434 &        	$0$ & 	$11.86$ & 	$0.893677$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$1$ & 	$32.06$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$0$ & 	$15.30$ & 	$0.965250$ \\
            ZipSlip &               $0$ & 	$17.76$ &   $0.196429$ \\
            ZipSlip & 	            $1$ & 	$11.51$ & 	$0.167092$ \\
        \end{tabular}
        \caption{}
        \label{tab:LSTM_tcf_erg}
    \end{table}
    \fi


\iffalse
    \section{Optimale Parameter}

            \paragraph{Architektur}
                versch architekturen:
                Single Small 50 neuronen eine schicht
                Single Big 250 neuronen eine schicht
                multi small 20 neuronen 3 schichten
                multi big 50 neuronrn 3 schichten
                deep erste 50 sonst 20 6 schichten

                singlesmall 43\% von Deep
                insgesamt am schnellsten single small
                wie zu erwarten,  deep am langsamsten

            \paragraph{Hyperparameter}<++>
                aktivierungs funktion
                -> dense layer with softmax or tanh
                batch size
                learning rate
                optimizer

            \paragraph{Ngram Größe}
                ngram größer -> langsamer

            \paragraph{Embedding}

                overhead berechnung embedding, muss allerdings nur einmal berechnet werden
                zu erkennen w2v mit embedding size = 2  und window = 4 wesentlich schneller
                embedding größer -> langsamer

                vergleich ngram
                im schnitt mit ngram gr 2 84\% von ngr 3 und 

                w2v bringt entscheidenden Vorteil gegenüber ohe:
                Jeweils vergleich der selben parameter außer w2v vs ohe:
                Single small w2v nur 30\% der zeit gegenüber single small ohe
                bei mulit w2v sogar nur 13\%
                im mittel über alle architekturen 21.5\% der Zeit von ohe bei verwendung w2v

            \paragraph{Architektur}
                teste eine schicht viele neuronen 
                eine schicht wenige neuronen
                mehrere schichten mehrere neuronen / mit dropout dazwischen
                viele schichten wenige neuronen /mit dropout dazwischen

                auf Grund des zeitlichen Faktors fallen Deep und multibig weg
                Also zu testen:
                Single Small
                Single 
                Multi Small
                Multi 

            \paragraph{Threadinfo}
                Hypothese:
                Threadinfos bringen was

                Einbinden von thread information auf verschiedenen wegen:
                Thread aware ngrams (tan)
                Thread aware ngrams for w2v (tanw2v)
                Thread change flag (tcf)

                varianten:
                tan
                tanw2v
                tcf
                tan tcf
                tan tanw2v
                tcf tanw2v
                tan tanw2v tcf

                ---> welcher dieser varianten am besten?

            \paragraph{Parameter}
                args
                time

                LSTM ohne Threadinfos mit OHE
                LSTM mit W2V ohne Threadinfos (ngram)
                LSTM mit W2V mit Threadinfos (ngram)
                LSTM mit W2V threadaware mit Threadinfos (ngram)
                LSTM mit W2V threadaware mit Threadinfos (ngram) und threadchangeflag
                LSTM mit W2Vthreadaware mit Threadinfos (ngram) und threadchangeflag, spezialtraining
                --> LSTM final

                Manche angriffe verändern Sequenz von syscalls nicht
                Hypothese:
                verwende Parameter um erg zu verb

                LSTM final + strlen
                LSTM final + time delta
                LSTM final + strlen + time delta
    \section{LSTM Ansatz}
\fi

    %\subsection{Timing}\label{sec:Ergebnis_timing}
    %\subsection{Return Value}\label{sec:Ergebnis_return}

