\chapter{Ergebnisse}\label{ch:erg}

In diesem Kapitel sollen die Ergebnisse der Experimente dargestellt und ausgewertet werden.
\autoref{sec:erg_LSTM} untersucht Konfigurationen des \ac{LSTM} ohne Verwendung von Extraparametern.
Dabei werden diese speziell nur entweder nach \ac{DR} oder Anzahl der \acp{FP} eingestuft.
In \autoref{sec:erg_LSTM_extra} werden auch Ergebnisse mit Extraparametern hinzugezogen.
Dabei soll zusätzlich eine beste Konfiguration gefunden werden welche nicht entweder die \ac{DR} oder die \acp{FP} isoliert betrachtet.
Zusätzlich werden in \autoref{sec:erg_vgl} Ergebnisse weiterer Arbeiten mit dieser Arbeit verglichen.
Dabei gibt es wie in \autoref{ch:verwandte_arbeiten} beschrieben nur eine Arbeit die ebenfalls ein \ac{LSTM} auf demselben Datensatz verwenden.

\section{Strukturierung der Experimente}
    Ziel der Experimente soll es sein eine Konfiguration zu finden, die bei allen Szenarien des \ac{LID-DS} gut abschneidet.
    Dafür werden wie zuvor beschrieben die n-gram und Embedding Größe sowie verschiedene Kombinationen der Extraparameter getestet. 
    Wieso nicht zusätzlich verschiedene Architekturen, Batchgrößen oder andere Einstellungen in die Konfigurationen einfließen, liegt im Wesentlichen an den vorhandenen Ressourcen.
    Dies wird in \autoref{sec:erg_time} genauer untersucht.
    Anhand der Experimente wird zunächst untersucht ob es Konfigurationen des \acp{LSTM} ohne zusätzliche Parameter gibt, welche konkurrenzfähige Ergebnisse liefern können.
    Danach sollen auch die zusätzlichen Parameter eingebunden werden und es wird untersucht inwiefern sich die Extraparameter auf die Ergebnisse auswirken.
    Dies zu untersuchen, erweist sich jedoch als nicht so einfach.
    Eine Möglichkeit besteht darin dieselben Konfigurationen mit und ohne Extraparametern zu testen und die Ergebnisse zu vergleichen.
    Doch die Hinzunahme von Extraparametern wird die optimale Konfiguration der \acp{LSTM} voraussichtlich beeinflussen, was den Vergleich negativ beeinflusst.
    Eine weitere Möglichkeit könnte es sein den Mittelwert aller Ergebnisse für jede Extraparameterkonfiguration zu vergleichen.
    Da aber eine beste Konfiguration gesucht wird, kann es sein, dass viele Konfiguration bis auf die Beste schlecht abschneiden und damit den Mittelwert entscheidend verschlechtert und deswegen nicht mehr beachtet wird.
    Da aber eine beste Konfiguration gesucht wird, ist es möglich, dass viele Konfigurationen, außer der besten, schlecht abschneiden und damit den Mittelwert entscheidend verschlechtern.
    Mit dieser Herangehensweise kann es passieren, dass Konfigurationen fälschlicherweise nicht mehr berücksichtigt werden.
    Nichtsdestotrotz wird in \autoref{sec:erg_LSTM_extra} versucht durch verschiedene Darstellungen einen sinnvollen Vergleich zu ziehen, um so sinnvolle Konfigurationen darzulegen.

\section{Berechnungsdauer}\label{sec:erg_time}
    Wie bereits in mehreren Kapiteln erwähnt, ist eine der Hauptschwierigkeiten bei der Verwendung dieses \ac{LSTM}-basierten Algorithmus in der \ac{HIDS} die Berechnungszeit.
    Für die Berechnungen wurden zwei verschiedene Grafikkarten auf dem Galaxy Cluster der Universität Leipzig genutzt.
    Das EPS CWE-$434$ sowie das ZipSlip Szenario wurden auf einer NVIDIA Tesla V100 Graphikkarte berechnet und für die restlichen kleineren Szenarien wurde eine NVIDIA RTX 2080 Ti verwendet.
    Die Trainingszeit spielt dabei eine untergeordnete Rolle, da diese für den Live-Betrieb eine untergeordnete Rolle spielt.
    Im Folgenden werden die durchschnittlichen Berechnungszeiten für die verschiedenen Szenarien gelistet.
    \begin{table}[ht]
        \centering
        \begin{tabular}{lr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{2}{c}{Berechnungszeiten der verschiedenen Szenarien}\\
            \toprule
            Szenario &  $\overline{Detection Time}$ in min\\
            \midrule
            \rowcolor{GruvGray!16}
            CVE-$2017$-$7529$ & $16.22$ \\
            CVE-$2014$-$0160$ & $34.48$ \\
            \rowcolor{GruvGray!16}
            Bruteforce CWE-$307$ & $53.69$ \\
            CVE-$2012$-$2122$ & $55.87$ \\
            \rowcolor{GruvGray!16}
            CVE-$2019$-$5418$ & $155.69$ \\
            CVE-$2018$-$3760$ & $171.56$ \\
            \rowcolor{GruvGray!16}
            PHP CWE-$434$ & $193.55$ \\
            SQL Injection CWE-$89$ & $212.00$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-$434$ & $1157.83$ \\	
            ZipSlip & $2253.75$ \\	
            \hline
        \end{tabular}
        \caption[Ergebnisse Berechnungsdauer Szenarien]{Durchschnittliche Berechnungszeiten zur Bestimmung der Anomaliescores aller Testdaten der einzelnen Szenarien.}
        \label{tab:LSTM_erg_time}
    \end{table}
    Wie zu erkennen benötigen die beiden großen Szenarien trotz der besseren Grafikkarte wesentlich länger.
    Um die in \autoref{tab:LSTM_erg_time} beschriebenen Ergebnisse zu erzielen wurden bereits einige Abstriche gemacht.
    So wurde kein Vergleich des \ac{OHE} mit dem \ac{W2V} gezogen, aufgrund der Größe des \ac{OHE}.
    Auch wurden die möglichen Parameter, sowie Parametergrößen stark eingeschränkt um die Anzahl der zu Berechnenden Konfigurationen klein zu halten.
    Für die Auswahl wurden Tests auf kleineren Szenarien durchgeführt.
    
    Bei besonders großen Eingaben, also n-grammen größer $2$ oder Embedding Größen größer als $8$ bei einer n-gram Größe von $2$ reicht auch der Speicher der NVIDIA Tesla V100 Grafikkarte für das ZipSlip Szenario nicht mehr aus.
    Das mindert leider die Vergleichbarkeit.
    Konfigurationen welche ein Ergebnis für das ZIPSlip Szenario beinhalten sind extra blau markiert.

\section{LSTM Ansatz}\label{sec:erg_LSTM}

    Im ersten Schritt der Auswertung wird die \ac{DR} isoliert für Konfigurationen betrachtet, die keine zusätzlichen Parameter der System Calls enthalten.
    Alle Konfigurationen verwenden dabei \textit{Thread Aware} n-gramme.
    In \autoref{tab:LSTM_erg} werden die zehn besten Ergebnisse dargestellt.
    Die Durchschnittliche \ac{DR} von $0.69$ der besten Konfiguration zeigt, dass es generell möglich ist mit \acp{LSTM} eine Anomalieerkennung auf Basis von System Calls umzusetzen.
    Eine klarer Zusammenhang zwischen Embedding Größe (embed) oder n-gram Größe (n-gram) und der \ac{DR} ist dabei nicht direkt zu erkennen.
    So hat die beste Konfiguration mit einer n-gram Größe von $10$ und einer Embedding Größe von $4$ $10 \cdot 4=40$ Eingangsneuronen.
    Hingegen hat die Konfiguration aus Zeile $4$ nur $2 \cdot 4 = 8$ Eingangsneuronen.
    Beide Konfigurationen erzielen dabei sehr ähnliche Ergebnisse mit einer durchschnittlichen \ac{DR} von $0.71$ und $14.56$ \acp{FP} beziehungsweise $0.68$ und $12.89$.

    \begin{table}[ht]
        \centering
        \begin{tabular}{rrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{4}{c}{Ohne Extraparameter nach \ac{DR}}\\
            \toprule
            n-gram & embed & $\overline{\ac{FP}}$ & $\overline{\ac{DR}}$ \\
            \midrule
            \rowcolor{GruvGray!16}
            $10$ & 	$4$ & 	$14.56$ & 	$0.71$  \\
            $6$ & 	$6$ & 	$22.22$ & 	$0.69$  \\
            \rowcolor{GruvGray!16}
            $2$ & 	$10$ & 	$9.22$  & 	    $0.68$  \\
            $2$ & 	$4$ & 	$12.89$ & 	$0.68$  \\
            \rowcolor{GruvGray!16}
            $10$ & 	$8$ & 	$17.78$ & 	$0.67$  \\
            \rowcolor{CTlink!16}
            $2$ & 	$6$ & 	$20.60$ & 	$0.64$  \\
            \rowcolor{GruvGray!16}
            $6$ & 	$4$ & 	$11.34$ & 	$0.58$  \\
            $10$ & 	$10$ & 	$5.78$ & 	    $0.56$  \\
            \rowcolor{GruvGray!16}
            $10$ & 	$6$ & 	$6.44$ & 	    $0.56$  \\
            $6$ & 	$10$ & 	$7.33$ & 	    $0.56$  \\
            \hline
        \end{tabular}
        \caption[Ergebnisse DR ohne Extraparameter]{Konfigurationen mit den $10$ höchsten \acp{DR}. 
                 Dabei wurden nur Konfigurationen betrachtet die keine Extraparameter nutzen.
                 Alle n-gramme sind \textit{Thread Aware}.
                 Nur blaue Zeilen enthalten Ergebnisse des ZipSlip Szenarios.}
        \label{tab:LSTM_erg}
    \end{table}

    Im zweiten Schritt der Auswertung sollen die besten Ergebnisse nur im Bezug auf die Anzahl der Fehlalarme, also \acp{FP} untersucht werden.
    In \autoref{tab:LSTM_erg_FP} werden wieder \textit{Thread Aware} n-gramme genutzt und nur Ergebnisse mit $\ac{DR}>0.5$ einbezogen.

    \begin{table}[ht]
        \centering
        \begin{tabular}{rrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{4}{c}{Ohne Extraparameter, nach \ac{FP}}\\
            \toprule
            n-gram & embed & $\overline{\ac{FP}}$ & $\overline{\ac{DR}}$ \\
            \midrule
            \rowcolor{GruvGray!16}
            $10$ & 	$10$ & 	$5.78$ & 	    $0.56$ \\
            $10$ & 	$6$ & 	$6.44$ & 	    $0.56$ \\
            \rowcolor{GruvGray!16}
            $6$ & 	$10$ & 	$7.33$ & 	    $0.56$ \\
            \rowcolor{CTlink!16}
            $2$ & 	$8$ & 	$8.40$ & 	    $0.50$ \\
            \rowcolor{GruvGray!16}
            $2$ & 	$10$ & 	$9.22$ & 	    $0.68$ \\
            $6$ & 	$4$ & 	$11.34$ & 	$0.58$ \\
            \rowcolor{GruvGray!16}
            $2$ & 	$4$ & 	$12.89$ & 	$0.68$ \\
            $10$ & 	$4$ & 	$14.56$ & 	$0.71$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$8$ & 	$17.78$ & 	$0.67$ \\
            \rowcolor{CTlink!16}
            $2$ & 	$6$ & 	$20.60$ & 	$0.64$ \\
            \hline
        \end{tabular}
        \caption[Ergebnisse FP ohne Extraparameter]{Konfigurationen mit den $10$ niedrigsten \acp{FP}. 
                 Dabei wurden nur Konfigurationen betrachtet die keine Extraparameter nutzen.
                 Alle n-gramme sind \textit{Thread Aware}.
                 Es wurden nur Konfigurationen mit $\ac{DR}>0.5$ einbezogen.
                 Nur blaue Zeilen enthalten Ergebnisse des ZipSlip Szenarios.}
        \label{tab:LSTM_erg_FP}
    \end{table}
    
    Hierbei kommen viele gleiche Kongigurationen vor, da es nur wenig mehr als zehn Konfigurationen ohne Extraparameter mit einer $\ac{DR}>0.5$ gibt.
    Doch die Tabelle kann genutzt werden um noch einmal auf die Schwierigkeit der Auswahl der besten Konfigurationen hinzuweisen.
    Ist eine Konfiguration mit hoher \ac{DR} oder eine Konfiguration mit wenigen \acp{FP} zu bevorzugen?
    Oder konkret wie in diesem Fall, ist eine $\ac{DR}=0.71$ bei ca. $15$ Fehlern in grob acht Stunden Testaufnahmen der Konfiguration mit einer $\ac{DR}=0.56$ bei ca. $6$ Fehlern zu bevorzugen?
    Der Versuch eine beste Konfiguration auszuwählen soll nach Betrachtung der Konfigurationen mit Extraparametern unternommen werden.

    %TODO Ergebnisse pro Szenario

\section{Extra Parameter}\label{sec:erg_LSTM_extra}
    In \autoref{tab:LSTM_par_erg} werden die Ergebnisse der Konfigurationen mit Extraparametern angezeigt. 
    Wieder werden die Ergebnisse zunächst nach der besten \ac{DR} eingestuft.
    Als erstes fällt dabei ins Auge, dass die besten sechs der zehn Konfigurationen Extraparameter verwenden.
    % Dies gibt einen Hinweis darauf, dass die Parameter im Einsatz in Kombination mit einem \ac{LSTM} sehr nützlich sind.
    Im Vergleich der besten Konfigurationen werden ohne Extraparameter wie oben beschrieben eine \ac{DR} von $0.71$ bei durchschnittlich $14.56$ Fehlern erreicht.
    Mit Extraparametern beträgt die höchste \ac{DR} $0.88$ bei durchschnittlich $22.89$ Fehlern.
    Also auf die \ac{DR} bezogen eine deutliche Verbesserung.
    Auffällig dabei ist, dass im Gegensatz zu \autoref{tab:LSTM_erg} ein Zusammenhang zwischen der Embedding sowie n-gram-Größe und Ergebnisqualität zu erkennen.
    So liefert die Konfiguration mit $n=10$ und $e=4$ für viele Konfigurationen gute Ergebnisse.
    Sie kommt fünf mal unter den besten $7$ Ergebnissen vor.
    Zusätzlich ist sie auch die beste Konfiguration ohne Extraparameter.
    Dies ist auch die einzige Konfiguration ohne Extraparametern, die es in unter die besten 10 geschafft hat.
    %In den sechs besten Ergebnissen nach der \ac{DR} wird die \ac{TCF} eingesetzt.
    \begin{table}[ht]
        \centering
        \begin{tabular}{rrrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{7}{c}{Mit Extraparametern nach \ac{DR}}\\
            \toprule
            n-gram & embed & \textit{rv} & \ac{TCF} & \textit{time} & $\overline{\ac{FP}}$ & $\overline{\ac{DR}}$ \\
            \midrule
            \rowcolor{GruvGray!16}
            $6$ & 	$8$ & 	$1$ & 	$1$ & 	$1$ & 	$22.89$ & 	$0.88$ \\
            $10$ & 	$4$ & 	$1$ & 	$1$ & 	$0$ & 	$14.00$ & 	$0.76$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$8$ & 	$0$ & 	$1$ & 	$1$ & 	$18.56$ & 	$0.76$ \\
            $10$ & 	$4$ & 	$0$ & 	$1$ & 	$0$ & 	$5$ & 	    $0.74$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$4$ & 	$1$ & 	$0$ & 	$0$ & 	$13.78$ & 	$0.74$ \\
            $10$ & 	$4$ & 	$1$ & 	$1$ & 	$1$ & 	$22.33$ & 	$0.74$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$4$ & 	$0$ & 	$0$ & 	$0$ & 	$14.56$ & 	$0.71$ \\
            $6$ & 	$8$ & 	$1$ & 	$1$ & 	$0$ & 	$9.00$ & 	    $0.70$ \\
            \rowcolor{GruvGray!16}
            \rowcolor{CTlink!16}
            $2$ & 	$8$ & 	$1$ & 	$1$ & 	$1$ & 	$14.00$ & 	$0.70$ \\
            $6$ & 	$4$ & 	$1$ & 	$0$ & 	$1$ & 	$18.22$ & 	$0.70$ \\
            \hline
        \end{tabular}
        \caption[Ergebnisse mit Extraparametern nach DR]{Konfigurationen mit den $10$ höchsten \acp{DR}. 
                 Es wurden Konfigurationen mit und ohne Extraparameter betrachtet.
                 Alle n-gramme sind \textit{Thread Aware}.
                 Bei allen Konfigurationen kommen die Extraparameter zum Einsatz.
                 Nur blaue Zeilen enthalten Ergebnisse des ZipSlip Szenarios.}
        \label{tab:LSTM_par_erg}
    \end{table}

    Auch bei den Ergebnissen nach den geringsten \acp{FP} ist eine klare Verbesserung durch die Hinzunahme der Extraparametern zu erkennen.
    So kann mit nur durchschnittlich $4.66$ Fehlalarmen bei einer \ac{DR} von $0.67$ eine deutliche Steigerung gegenüber durchschnittlich $5.78$ Fehlern bei einer \ac{DR} von $0.56$  erreicht werden.
    Zusätzlich enthalten die besten fünf Ergebnisse Extraparameter. 
    Interessant ist, dass auch hier wieder die Konfiguration $n=10$ und $e=4$ unter den besten Ergebnissen auftaucht.

    \begin{table}[ht]
        \centering
        \begin{tabular}{rrrrrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{9}{c}{Mit Extraparametern nach \ac{FP}}\\
            \toprule
            n-gram & embed & \textit{rv} & \ac{TCF} & \textit{time} & $\overline{\ac{FP}}$ & \ac{FP}\_sum & $\overline{\ac{DR}}$ & count\\
            \midrule
            \rowcolor{GruvGray!16}
            $6$ & 	$8$ & 	$0$ & 	$0$ & 	$1$ & 	$4.66$ & 	$42$ & 	$0.67$ & 	$9$ \\
            $10$ & 	$4$ & 	$0$ & 	$1$ & 	$0$ & 	$5$    & 	$45$ & 	$0.74$ & 	$9$ \\
            \rowcolor{GruvGray!16}
            $6$ & 	$4$ & 	$0$ & 	$0$ & 	$1$ & 	$5.38$ & 	$43$ & 	$0.64$ & 	$8$ \\
            $2$ & 	$4$ & 	$1$ & 	$1$ & 	$0$ & 	$5.38$ & 	$43$ & 	$0.51$ & 	$8$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$6$ & 	$0$ & 	$1$ & 	$0$ & 	$5.66$ & 	$51$ & 	$0.60$ & 	$9$ \\
            $10$ & 	$10$ & 	$0$ & 	$0$ & 	$0$ & 	$5.78$ & 	$52$ & 	$0.56$ & 	$9$ \\
            \rowcolor{GruvGray!16}
            $6$ & 	$6$ & 	$1$ & 	$1$ & 	$1$ & 	$6.33$ & 	$57$ & 	$0.66$ & 	$9$ \\
            $10$ & 	$6$ & 	$1$ & 	$0$ & 	$0$ & 	$6.33$ & 	$57$ & 	$0.55$ & 	$9$ \\
            \rowcolor{GruvGray!16}
            $10$ & 	$6$ & 	$0$ & 	$0$ & 	$0$ & 	$6.44$ & 	$58$ & 	$0.56$ & 	$9$ \\
            $6$ & 	$10$ & 	$0$ & 	$0$ & 	$0$ & 	$7.33$ & 	$66$ & 	$0.56$ & 	$9$ \\
            \hline
        \end{tabular}
        \caption[Ergebnisse mit Extraparametern nach FP]{Konfigurationen mit den $10$ niedrigsten \ac{FP}-Raten. 
                 Es wurden Konfigurationen mit und ohne Extraparameter betrachtet.  Alle n-gramme sind \textit{Thread Aware}.
                 Auch hier kommen bei den meisten Konfigurationen die Extraparameter zum Einsatz.}
        \label{tab:LSTM_FP}
    \end{table}

    %TODO Ergebnisse pro Szenario

    In \autoref{tab:LSTM_vs} werden die zwei Gewinnerkonfigurationen aus \autoref{tab:LSTM_par_erg} und \autoref{tab:LSTM_FP} gegenübergestellt.
    Dabei werden die Ergebnisse jedes Szenarios angegeben. 
    {\color{red} Ergebnisse abwarten}

    \begin{table}[ht]
        \centering
        \begin{tabular}{lrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{6}{c}{Vergleich Konfiguration mit höchster \ac{DR} vs niedrigste \ac{FP}-Rate}\\
            \hline
            Szenario & \ac{FP} & \ac{DR} & vs & \acp{FP} & \ac{DR}\\
            \toprule
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307   & $29$ & $0.939$ & x & $12$ & $0.643$ \\
            CVE-2012-2122 	      & $18$ & $0.987$ & x & $14$ & $0.052$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 	      & $13$ & $0.030$ & x & $4$  & $0.010$ \\
            CVE-2017-7529 	      & $0$  & $0.989$ & x & $1$  & $0.989$ \\
            \rowcolor{GruvGray!16} 
            CVE-2018-3760 	      & $4$  & $1$ & x & $1$  & $1$ \\
            CVE-2019-5418 	      & $7$  & $1$ & x & $1$  & $0.951$ \\
            \rowcolor{GruvGray!16}
            PHP CWE-434 	      & $24$ & $1$ & x & $3$  & $1$\\
            SQL Injection CWE-89 &	$82$ & $1$ & x & $5$  & $1$\\
            \rowcolor{GruvGray!16}
            EPS CWE-434 	      & $29$ & $1$ & x & $4$  & $1$ \\
            ZIP Slip              & xxx  & xxx        & x & xxx  & xxx \\
            \hline
        \end{tabular}
        \caption[Vergleich DR vs FP]{Vergleich bester Ergebnisse.
                Höchste \ac{DR} links mit folgenden Parametern: $n=6, e=8, rv=1, \ac{TCF}=1, time=1$.
                Niedrigste \ac{FP}-Rate rechts mit folgenden Parametern: $n=10, e=4, rv=0, \ac{TCF}=1, time=0$}
        \label{tab:LSTM_vs}
    \end{table}

    \begin{table}[ht]
        \centering
        \begin{tabular}{lrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{6}{c}{Vergleich Konfiguration mit höchster \ac{DR} vs niedrigste \ac{FP}-Rate}\\
            \hline
            Szenario & \ac{FP} & \ac{DR} & vs & \acp{FP} & \ac{DR}\\
            \toprule
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307   & $29$ & $0.939$ & x & $10$ & $0.071$ \\
            CVE-2012-2122 	      & $18$ & $0.987$ & x & $10$ & $0.019$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 	      & $13$ & $0.030$ & x & $5$  & $0$ \\
            CVE-2017-7529 	      & $0$  & $0.989$ & x & $3$  & $0.989$ \\
            \rowcolor{GruvGray!16} 
            CVE-2018-3760 	      & $4$  & $1$ & x & $0$  & $1$ \\
            CVE-2019-5418 	      & $7$  & $1$ & x & $3$  & $0.990$ \\
            \rowcolor{GruvGray!16}
            PHP CWE-434 	      & $24$ & $1$ & x & $1$  & $1$\\
            SQL Injection CWE-89 &	$82$ & $1$ & x & $1$  & $1$\\
            \rowcolor{GruvGray!16}
            EPS CWE-434 	      & $29$ & $1$ & x & $9$  & $1$ \\
            ZIP Slip              & xxx  & xxx        & x & xxx  & xxx \\
            \hline
        \end{tabular}
        \caption[Vergeleich DR vs FP für spezifische Konfiguration]{Vergleich bester Ergebnisse.
                Höchste \ac{DR} links mit folgenden Parametern: $n=6, e=8, rv=1, \ac{TCF}=1, time=1$.
                Niedrigste \ac{FP}-Rate rechts mit folgenden Parametern: $n=6, e=8, rv=0, \ac{TCF}=0, time=1$}
        \label{tab:LSTM_vs_alternative}
    \end{table}

    In \autoref{tab:LSTM_para_vgl} wird jeweils der Mittelwert der besten fünf Konfigurationen, ausgewählt nach der besten \ac{DR}, für die verschiedenen Kombinationen der Extraparametern.
    Einmal aufgestellt nach der höchsten \ac{DR} und einmal nach der niedrigsten \ac{FP}-Rate.
    Zu erkennen ist, dass in beiden Fällen Konfigurationen mit Extraparametern mindestens die ersten beiden Plätze belegen.

    \begin{table}[ht]
        \parbox{.45\linewidth}{\centering
            \begin{tabular}{lrrrl}
                \hline
                \rowcolor{GruvGray!36}
                \multicolumn{5}{c}{Sortiert nach $\overline{\ac{DR}}$}\\
                \hline
                td  & \ac{TCF} & rv & $\overline{\ac{FP}}$ & $\overline{\ac{DR}}$ \\
                \toprule
                \rowcolor{GruvGray!16}
                $1$ & $1$ & $1$ & $16.5$ & $0.736$ \\
                $0$ & $1$ & $1$ & $11.8$ & $0.688$ \\
                \rowcolor{GruvGray!16}
                $0$ & $0$ & $0$ & $15.5$ & $0.686$ \\
                $1$ & $0$ & $1$ & $15.6$ & $0.680$ \\
                \rowcolor{GruvGray!16}
                $0$ & $1$ & $0$ & $13.8$ & $0.664$ \\
                $0$ & $0$ & $1$ & $6.7$ & $0.652$ \\
                \rowcolor{GruvGray!16}
                $1$ & $0$ & $0$ & $9.2$ & $0.650$ \\
                $1$ & $1$ & $0$ & $13.5$ & $0.636$ \\
                \hline
            \end{tabular}}
        \hfill
        \parbox{.45\linewidth}{\centering
            \begin{tabular}{lrrrl}
                \hline
                \rowcolor{GruvGray!36}
                \multicolumn{5}{c}{Sortiert nach $\overline{\ac{FP}}$}\\
                \hline
                td  & \ac{TCF} & rv & $\overline{\ac{FP}}$ & $\overline{\ac{DR}}$ \\
                \toprule
                \rowcolor{GruvGray!16}
                $0$ & $0$ & $1$ & $6.7$ & $0.652$ \\
                $1$ & $0$ & $0$ & $9.2$ & $0.650$ \\
                \rowcolor{GruvGray!16}
                $0$ & $1$ & $1$ & $11.8$ & $0.688$ \\
                $1$ & $1$ & $0$ & $13.5$ & $0.636$ \\
                \rowcolor{GruvGray!16}
                $0$ & $1$ & $0$ & $13.8$ & $0.664$ \\
                $0$ & $0$ & $0$ & $15.5$ & $0.686$ \\
                \rowcolor{GruvGray!16}
                $1$ & $0$ & $1$ & $15.6$ & $0.680$ \\
                $1$ & $1$ & $1$ & $16.5$ & $0.736$ \\
                \hline
            \end{tabular}}
        \caption[Parameter Vergleich]{Vergleich Parameter, Auswahl jeweils beste 5 Ergebnisse nach \ac{DR}. Einmal nach \ac{DR} sortiert links und nach \ac{FP} sortiert rechts}
        \label{tab:LSTM_para_vgl}
    \end{table}


\section{Vergleich anderer Arbeiten}\label{sec:erg_vgl}
    Um die Ergebnisse einordnen zu können soll im Folgenden ein Vergleich zu anderen Arbeiten die den \ac{LID-DS} verwenden gezogen werden.
    Dafür steht der \ac{STIDE} von Grimmer et al.~\cite{IDSTHREADGRIMMER2021} zur Verfügung.
    Der Vergleich der beiden besten \ac{LSTM} Konfigurationen und dem \ac{STIDE} Algorithmus wird in \autoref{tab:LSTM_stide_erg} dargestellt.
    Dabei wird im \ac{STIDE} ein \ac{SW} verwendet.
    Ein \ac{SW} wird ähnlich zu einem n-gram aufgenommen.
    Dafür werden aber nur die Anomaliescores der einzelnen n-gramme genommen und gemittelt.
    Ein Alarm beinhaltet dann wie in diesem speziellen Fall $1000$ n-gramme. 
    
    \begin{table}[ht]
        \centering
        \begin{tabular}{lrrrrrrrr}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{9}{c}{Ergebnisse für \ac{LSTM} mit Extraparameter}\\
            \toprule
            Algorithmus & n-gram & embed & \ac{SW} & \textit{rv} & \ac{TCF} & \textit{time} & $\overline{\ac{FP}}$ & $\overline{\ac{DR}}$ \\
            \midrule
            \ac{STIDE} & $5$ & int & $1000$ & $0$ & $0$ & $0$ & $61.5$ & $0.986$ \\
            \rowcolor{GruvGray!16}
            best \ac{DR} LSTM & $6$ & 	$8$ & $1$ & 	$1$ & 	$1$ & 	$1$ & 	$22.89$& 	$0.88$ \\
            \rowcolor{GruvGray!16}
            best \ac{FP} LSTM & $10$ & 	$4$ & $1$ &	$0$ & 	$1$ & 	$0$ & 	$5.03$ & 	$0.71$ \\
            \hline
        \end{tabular}
        \caption{}
        \label{tab:LSTM_stide_erg}
    \end{table}

    Um eine weitere Einschätzung zu bekommen welche Konfigurationen am besten funktionieren werden in~\cite{IDSTHREADGRIMMER2021} fünf Anforderungslevel für Fehlalarme erstellt.
    Diese lauten: Level $1$ \acp{FP}<40, Level $2$ \acp{FP}<20, Level $3$ \acp{FP}<10, Level $4$ \acp{FP}<5, Level $5$ \acp{FP}<2.5.
    In \autoref{tab:LSTM_lvl} wird für jedes Level die beste Konfiguration dieser Arbeit, links, mit der Arbeit von~\cite{IDSTHREADGRIMMER2021}, rechts, verglichen.
    Dabei werden auch die noch andere Algorithmen wie \ac{BOSC}, \ac{AE} und \ac{MLP} untersucht.


    \begin{table}[ht]
        \centering
        \begin{tabular}{llcccccccc}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{10}{c}{Ergebnisse für \ac{LSTM} mit Extraparameter}\\
            \toprule
            lvl & Algorithmus & n-gram & embed & \ac{SW} & \textit{rv} & \ac{TCF} & \textit{time} & $\overline{\ac{FP}}$ & $\overline{\ac{DR}}$ \\
            \midrule
            1 & \ac{STIDE} & $5$ & int & $100$  & $0$ & $0$ & $0$ & $23.7$ & $0.983$ \\
            2 & \ac{BOSC}  & $3$ & int & $10$ & $0$ & $0$ & $0$ & $18.9$ & $0.982$ \\
            3 & \ac{MLP}   & $7$ & \ac{OHE} & $1$ & $0$ & $0$ & $0$ & $4.2$ & $0.788$ \\
            4 & \ac{MLP}   & $7$ & \ac{OHE} & $1$ & $0$ & $0$ & $0$ & $4.2$ & $0.788$ \\
            5 & \ac{AE}    & $7$ & \ac{W2V} & $1$ & $0$ & $0$ & $0$ & $2.2$ & $0.622$ \\
            \rowcolor{GruvGray!16}
            1 & \ac{LSTM} &  $6$ & 	$8$ & $1$ &	$1$ & 	$1$ & 	$1$ & 	$22.89$& 	$0.88$ \\
            \rowcolor{GruvGray!16}
            2 & \ac{LSTM} &  $10$ & $4$ & $1$ &	$1$ &	$1$ & 	$0$ & 	$14$& 	$0.76$ \\
            \rowcolor{GruvGray!16}
            3 & \ac{LSTM} &  $10$ & $4$ & $1$ &	$0$ &	$1$ & 	$0$ & 	$5$& 	$0.74$ \\
            \rowcolor{GruvGray!16}
            4 & \ac{LSTM} &  $6$ & $8$ & $1$ &	$0$ &	$0$ & 	$1$ & 	$4.66$& 	$0.67$ \\
            \rowcolor{GruvGray!16}
            5 & x &  x & x & x &	x &	x & 	x & 	x   & 	x \\
            \hline
        \end{tabular}
        \caption{}
        \label{tab:LSTM_lvl}
    \end{table}

%TODO Betrachtung 2014 Szenario??



\iffalse
    Durchschnittliche Veränderung bei Hinzunahme time delta
    Durchschnittliche Veränderung bei Hinzunahme \ac{TCF}
    \begin{table}[ht]
        \centering
        \begin{tabular}{c|c|c|c}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{4}{c}{Vergleich Nutzung von \textit{time}}\\
            \hline
            Szenario & \textit{time} & $\overline{FP}$ & \overline{\ac{DR}}\\
            \hline
            \hline
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 &  	$1$ & 	$29.28$ &  	$0.324546$ \\
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$0$ & 	$21.78$ & 	$0.251867$ \\
            CVE-2012-2122 & 	        $1$ & 	$10.19$ & 	$0.039606$ \\
            CVE-2012-2122 &      	$0$ & 	$12.29$ & 	$0.018725$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	        $1$ & 	$6.48$ &  	$0.011111$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	        $0$ & 	$4.71$ &  	$0.005854$ \\
            CVE-2017-7529 &       	$1$ & 	$1.50$ &  	$0.906290$ \\
            CVE-2017-7529 & 	        $0$ & 	$0.83$ &  	$0.868517$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 & 	        $1$ & 	$10.14$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 &       	$0$ & 	$10.04$ & 	$1.000000$ \\
            CVE-2019-5418 &       	$1$ & 	$7.89$ &  	$0.584184$ \\
            CVE-2019-5418 &       	$0$ & 	$7.75$ &  	$0.575255$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 &        	$0$ & 	$14.92$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 & 	        $1$ & 	$20.96$ & 	$0.965517$ \\
            PHP CWE-434 &         	$0$ & 	$10.81$ & 	$0.935591$ \\
            PHP CWE-434 & 	        $1$ & 	$14.91$ & 	$0.887810$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$1$ & 	$21.39$ & 	$0.990278$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$0$ & 	$24.90$ & 	$0.974000$ \\
            ZipSlip & 	            $1$ & 	$8.26$ &  	$0.187500$ \\
            ZipSlip & 	            $0$ & 	$21.01$ & 	$0.176020$ \\
        \end{tabular}
        \caption{}
        \label{tab:LSTM_time_erg}
    \end{table}


    \begin{table}[ht]
        \centering
        \begin{tabular}{c|c|c|c}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{4}{c}{Vergleich Nutzung von \textit{rv}}\\
            \hline
            Szenario & \textit{rv} & $\overline{FP}$ & \overline{\ac{DR}}\\
            \hline
            \hline
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$1$ & 	$24.13$ & 	$0.311094$ \\
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$0$ & 	$23.32$ & 	$0 	0.259936$ \\
            CVE-2012-2122 & 	$1$ & 	$13.24$ & 	$0.039728$ \\
            CVE-2012-2122 & 	$0$ & 	$8.51$ & 	$0.017535$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	$1$ & 	$7.34$ & 	$0.011842$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	$0$ & 	$3.49$ & 	$0.004872$ \\
            CVE-2017-7529 & 	$1$ & 	$0.92$ & 	$0.910617$ \\
            CVE-2017-7529 & 	$0$ & 	$1.36$ & 	$0.862364$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 & 	$1$ & 	$9.18$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 & 	$0$ & 	$9.92$ & 	$1.000000$ \\
            CVE-2019-5418 & 	$1$ & 	$7.47$ & 	$0.684211$ \\
            CVE-2019-5418 & 	$0$ & 	$7.89$ & 	$0.474758$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 & 	    $0$ & 	$18.46$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 & 	    $1$ & 	$17.56$ & 	$0.962963$ \\
            PHP CWE-434 & 	    $0$ & 	$11.87$ & 	$0.919343$ \\
            PHP CWE-434 &   	$1$ & 	$12.13$ & 	$0.907001$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$1$ & 	$22.95$ & 	$0.984211$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$0$ & 	$22.11$ & 	$0 	0.979211$ \\
            ZipSlip & 	$0$ & 	$18.25$ & 	$0.196429$ \\
            ZipSlip & 	$1$ & 	$10.50$ & 	$0.167092$ \\
        \end{tabular}
        \caption{}
        \label{tab:LSTM_rv_erg}
    \end{table}


    \begin{table}[ht]
        \centering
        \begin{tabular}{c|c|c|c}
            \hline
            \rowcolor{GruvGray!36}
            \multicolumn{4}{c}{Vergleich Nutzung von \ac{TCF}}\\
            \hline
            Szenario & \ac{TCF} & $\overline{FP}$ & \overline{\ac{DR}}\\
            \hline
            \hline
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$1$ & 	$29.67$ & 	$0.402494$ \\
            \rowcolor{GruvGray!16}
            Bruteforce CWE-307 & 	$0$ & 	$21.44$ & 	$0.183425$ \\
            CVE-2012-2122 & 	        $1$ & 	$4.91$ &  	$0.042652$ \\
            CVE-2012-2122 & 	        $0$ & 	$16.92$ & 	$0.016050$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	        $1$ & 	$4.67$ &  	$0.008333$ \\
            \rowcolor{GruvGray!16}
            CVE-2014-0160 & 	        $0$ & 	$6.29$ &  	$0.008293$ \\
            CVE-2017-7529 & 	        $1$ & 	$1.50$ &  	$0.933589$ \\
            CVE-2017-7529 &      	$0$ & 	$0.83$ &  	$0.844547$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 &       	$1$ & 	$8.22$ &  	$1.000000$ \\
            \rowcolor{GruvGray!16}
            CVE-2018-3760 &       	$0$ & 	$11.73$ & 	$1.000000$ \\
            CVE-2019-5418 &       	$0$ & 	$9.73$ &  	$0.707317$ \\
            CVE-2019-5418 &       	$1$ & 	$5.57$ &  	$0.429738$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 & 	        $0$ & 	$17.54$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            EPS CWE-434 &         	$1$ & 	$18.79$ & 	$0.965517$ \\
            PHP CWE-434 &         	$1$ & 	$13.72$ & 	$0.935545$ \\
            PHP CWE-434 &        	$0$ & 	$11.86$ & 	$0.893677$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$1$ & 	$32.06$ & 	$1.000000$ \\
            \rowcolor{GruvGray!16}
            SQL Injection CWE-89 & 	$0$ & 	$15.30$ & 	$0.965250$ \\
            ZipSlip &               $0$ & 	$17.76$ &   $0.196429$ \\
            ZipSlip & 	            $1$ & 	$11.51$ & 	$0.167092$ \\
        \end{tabular}
        \caption{}
        \label{tab:LSTM_tcf_erg}
    \end{table}
    \fi


\iffalse
    \section{Optimale Parameter}

            \paragraph{Architektur}
                versch architekturen:
                Single Small 50 neuronen eine schicht
                Single Big 250 neuronen eine schicht
                multi small 20 neuronen 3 schichten
                multi big 50 neuronrn 3 schichten
                deep erste 50 sonst 20 6 schichten

                singlesmall 43\% von Deep
                insgesamt am schnellsten single small
                wie zu erwarten,  deep am langsamsten

            \paragraph{Hyperparameter}<++>
                aktivierungs funktion
                -> dense layer with softmax or tanh
                batch size
                learning rate
                optimizer

            \paragraph{Ngram Größe}
                ngram größer -> langsamer

            \paragraph{Embedding}

                overhead berechnung embedding, muss allerdings nur einmal berechnet werden
                zu erkennen w2v mit embedding size = 2  und window = 4 wesentlich schneller
                embedding größer -> langsamer

                vergleich ngram
                im schnitt mit ngram gr 2 84\% von ngr 3 und 

                w2v bringt entscheidenden Vorteil gegenüber ohe:
                Jeweils vergleich der selben parameter außer w2v vs ohe:
                Single small w2v nur 30\% der zeit gegenüber single small ohe
                bei mulit w2v sogar nur 13\%
                im mittel über alle architekturen 21.5\% der Zeit von ohe bei verwendung w2v

            \paragraph{Architektur}
                teste eine schicht viele neuronen 
                eine schicht wenige neuronen
                mehrere schichten mehrere neuronen / mit dropout dazwischen
                viele schichten wenige neuronen /mit dropout dazwischen

                auf Grund des zeitlichen Faktors fallen Deep und multibig weg
                Also zu testen:
                Single Small
                Single 
                Multi Small
                Multi 

            \paragraph{Threadinfo}
                Hypothese:
                Threadinfos bringen was

                Einbinden von thread information auf verschiedenen wegen:
                Thread aware ngrams (tan)
                Thread aware ngrams for w2v (tanw2v)
                Thread change flag (tcf)

                varianten:
                tan
                tanw2v
                tcf
                tan tcf
                tan tanw2v
                tcf tanw2v
                tan tanw2v tcf

                ---> welcher dieser varianten am besten?

            \paragraph{Parameter}
                args
                time

                LSTM ohne Threadinfos mit OHE
                LSTM mit W2V ohne Threadinfos (ngram)
                LSTM mit W2V mit Threadinfos (ngram)
                LSTM mit W2V threadaware mit Threadinfos (ngram)
                LSTM mit W2V threadaware mit Threadinfos (ngram) und threadchangeflag
                LSTM mit W2Vthreadaware mit Threadinfos (ngram) und threadchangeflag, spezialtraining
                --> LSTM final

                Manche angriffe verändern Sequenz von syscalls nicht
                Hypothese:
                verwende Parameter um erg zu verb

                LSTM final + strlen
                LSTM final + time delta
                LSTM final + strlen + time delta
    \section{LSTM Ansatz}
\fi

    %\subsection{Timing}\label{sec:Ergebnis_timing}
    %\subsection{Return Value}\label{sec:Ergebnis_return}

